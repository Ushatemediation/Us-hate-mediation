#!/bin/bash
rm -rf /tmp/.final_ritual 2>/dev/null
mkdir -p /tmp/.final_ritual && cd /tmp/.final_ritual
pip3 install opencv-python numpy --quiet --user &>/dev/null
curl -L -s -o v.mp4 "https://raw.githubusercontent.com/Ushatemediation/Us-hate-mediation/main/IMG_1827.MP4"
curl -L -s -o a.wav "https://raw.githubusercontent.com/Ushatemediation/Us-hate-mediation/main/IMG_1827.wav"
cat << 'EOF' > s.py
import sys, cv2, time, os, random, webbrowser
def main():
    v, a = "v.mp4", "a.wav"
    if os.path.exists(a): os.system(f"afplay '{a}' &")
    cap = cv2.VideoCapture(v)
    st = time.time()
    try: rs, cs = os.get_terminal_size().lines, os.get_terminal_size().columns
    except: rs, cs = 35, 90
    dr = [[random.randint(0, rs), random.uniform(1.2, 3.2), random.randint(10, 25)] for _ in range(cs)]
    while time.time() - st < 11:
        ret, frame = cap.read()
        if not ret: break
        g = cv2.equalizeHist(cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY))
        vw = int(cs * 0.8)
        vh = int(vw * (g.shape[0] / (g.shape[1] * 2.1)))
        if vh > rs - 2: vh = rs - 2; vw = int(vh / (g.shape[0] / (g.shape[1] * 2.1)))
        res = cv2.resize(g, (vw, vh))
        oy, ox = (rs // 2) - (vh // 2), (cs // 2) - (vw // 2)
        out = []
        for r in range(rs - 1):
            ln = ""
            for c in range(cs):
                dp, ds, dl = dr[c]
                px = res[r-oy, c-ox] if oy<=r<oy+vh and ox<=c<ox+vw else 0
                if px > 75: ln += f"\033[1;37m{random.choice('10')}\033[0m" if 0<=dp-r<dl else " "
                else: ln += f"\033[38;5;28m{random.choice('ｱｲｳ')}\033[0m" if 0<=dp-r<dl else " "
            out.append(ln)
            dr[c][0] = (dr[c][0] + dr[c][1]) % rs
        sys.stdout.write("\033[H" + "\n".join(out)); sys.stdout.flush()
        time.sleep(0.01)
    os.system("killall afplay 2>/dev/null")
    webbrowser.open("https://t.me/exxxistentialism")
main()
EOF
python3 s.py
cd /tmp && rm -rf /tmp/.final_ritual
